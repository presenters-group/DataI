<h2 mat-dialog-title>Add Visualizer</h2>

<mat-dialog-content>
  <form [formGroup]="form">
    <mat-form-field appearance="legacy">
      <mat-label for="name">Name:</mat-label>
      <input
        ngDefaultControl
        matInput
        placeholder="Visualizer1"
        id="name"
        type="text"
        formControlName="name"
      />
    </mat-form-field>

    <mat-form-field>
      <mat-label>Data Source</mat-label>
      <mat-select formControlName="data">
        <mat-select-trigger>
          {{
            form.value.data ? (dataSources | async)[form.value.data].name : ""
          }}
        </mat-select-trigger>
        <mat-option
          *ngFor="let data of objectKeys(dataSources | async)"
          [value]="data"
          >{{ (dataSources | async)[data].name }}</mat-option
        >
      </mat-select>
    </mat-form-field>

    <mat-form-field>
      <mat-label>Columns</mat-label>
      <mat-select formArrayName="usedColumns" multiple>
        <mat-select-trigger>
          {{
            form.value.usedColumns.length
              ? (dataSources | async)[form.value.data].columns[
                  form.value.usedColumns[0]
                ].name
              : ""
          }}
          <span
            *ngIf="form.value.usedColumns?.length > 1"
            class="example-additional-selection"
          >
            (+{{ form.value.usedColumns.length - 1 }}
            {{ form.value.usedColumns?.length === 2 ? "other" : "others" }})
          </span>
        </mat-select-trigger>
        <ng-container *ngIf="form.value.data != ''">
          <mat-option
            *ngFor="
              let column of objectKeys((dataSources | async)[form.value.data].columns)
            "
            [value]="column"
            >{{
              (dataSources | async)[form.value.data].columns[column].name
            }}</mat-option
          >
        </ng-container>
      </mat-select>
    </mat-form-field>

    <!-- <mat-form-field appearance="legacy">
      <mat-label for="usedColumns">Used Columns:</mat-label>
      <input
        matInput
        placeholder="1,2,3"
        id="usedColumns"
        type="text"
        formArrayName="usedColumns"
      />
    </mat-form-field> -->

    <mat-form-field appearance="legacy">
      <mat-label for="xColumn">X Column:</mat-label>
      <input
        matInput
        placeholder="1"
        id="xColumn"
        type="text"
        formControlName="xColumn"
      />
    </mat-form-field>

    <mat-form-field appearance="legacy">
      <mat-label for="chart">Chart:</mat-label>
      <input
        matInput
        placeholder="BarChart"
        id="chart"
        type="text"
        formControlName="chart"
      />
    </mat-form-field>

    <mat-form-field appearance="legacy">
      <mat-label for="filters">Filters:</mat-label>
      <input
        matInput
        placeholder="1,2,3"
        id="filters"
        type="text"
        formArrayName="filters"
      />
    </mat-form-field>
  </form>
</mat-dialog-content>

<div mat-dialog-actions>
  <button mat-flat-button (click)="onNoClick()">Cancel</button>
  <button
    mat-flat-button
    color="primary"
    [mat-dialog-close]="form"
    cdkFocusInitial
  >
    Add
  </button>
</div>
